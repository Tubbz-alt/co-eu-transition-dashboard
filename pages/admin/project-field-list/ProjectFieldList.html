{% extends "template.njk" %}
{% from "govuk/components/panel/macro.njk" import govukPanel %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% set fields = getFields() | await %}
{% set fieldGroups = getProjectGroups() | await %}
{% set fieldType = '' %}

{% block pageTitle %}Project Data Input{% endblock %}

{% block content %}

{% if flash %}
{{ flash }}
{% endif %}

<form action="{{ url }}/edit" method="post">
  <input type="text" name="fields[][0][id]" value="{{ fields[0].id }}" />
  <input type="text"name="fields[][0][order]" value="{{ fields[0].order }}" />

  <input type="text" name="fields[][1][id]" value="{{ fields[1].id }}" />
  <input type="text"name="fields[][1][order]" value="{{ fields[1].order }}" />

  <input type="submit" name="submit" value="submit" />
</form>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

  <h1 class="govuk-heading-xl">Manage project data input fields</h1>

  <p class="govuk-body-l">Changes made to the data input fields will
  be reflected in the downloadable template for the MI commision. </p>

  <p class="govuk-body">
    <a href="{{ config.paths.admin.projectField }}" class="govuk-link">Add a new field</a><br>
    <a href="#" id="reorder-fields" class="govuk-link">Re-order fields</a><br>
  </p>
  <hr class="govuk-section-break govuk-section-break--m">

  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">

  <form action="{{ url }}/edit" method="post">

  {% for fieldGroup in fieldGroups %}
  <table class="govuk-table project-fields">
    <caption class="govuk-table__caption">{{ fieldGroup.name }}</caption>
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
      <div class="reorder-row">
        <th scope="col" class="govuk-table__header"></th>
        <th scope="col" class="govuk-table__header"></th>
      </div>
      <th scope="col" class="govuk-table__header">Field Name</th>
      <th scope="col" class="govuk-table__header">Field Type</th>
      <th scope="col" class="govuk-table__header">Status</th>
      <th scope="col" class="govuk-table__header"></th>
      </tr>
    </thead>
    <tbody class="govuk-table__body">
    {% for field in fields | sort(attribute='order') %}
      {% if field.group == fieldGroup.name %}
      <tr class="govuk-table__row">
          <td class="govuk-table__cell">
          <input type="text"name="fields[][0][order]" value="{{ field.order }}" />
          <input type="text" name="fields[][0][id]" value="{{ field.id }}" />
          <button type="button" class="move-up">&#8679;</button></td>
          <td class="govuk-table__cell"><button type="button" class="move-down">&#8681;</button></td>
        <td class="govuk-table__cell">{{ field.displayName | default('') | string }}</td>
        {% if field.type == 'group' %}
          {% set fieldType = 'Drop down' %}
        {% elif field.type == 'string' %}
          {% set fieldType = 'Free text' %}
        {% elif field.type == 'integer' %}
          {% set fieldType = 'Number' %}
        {% elif field.type == 'date' %}
          {% set fieldType = 'Date input' %}
        {% elif field.type == 'boolean' %}
          {% set fieldType = 'Yes / No' %}
        {% endif %}
        <td class="govuk-table__cell">{{ fieldType }}</td>          
        <td class="govuk-table__cell">{{ "Active" if (field.isActive == true) else "Not active" }}</td>
        <td class="govuk-table__cell"><a href="{{ config.paths.admin.projectField + '/' + field.id }}" class="govuk-link">Edit</a></td>
      </tr>
      {% endif %}
    {% endfor %}
    </tbody>
  </table>
  {% endfor %}

  {{ govukButton({
    text: "Apply changes",
    type: "submit",
    name: "submit",
    preventDoubleClick: true
  }) }}

  </form>

 </div>
</div>

{% endblock %}

{% block afterScript %}
  <script>
    TRANSITIONDELIVERYDASHBOARD.fieldOrder();
  </script>
{% endblock %}